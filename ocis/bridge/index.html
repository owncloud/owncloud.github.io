<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Bridge">

<title>Bridge | owncloud</title>
<link rel="icon" href="/favicon/favicon-32x32.png" type="image/x-icon">

<link rel="stylesheet" href="/main.min.css">

<link rel="stylesheet" href="/custom.css">


<!--
    Made with Geekdoc theme
    https://github.com/xoxys/hugo-geekdoc
-->

</head>

<body>
    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><symbol viewBox="0 0 24 24" id="arrow_back" xmlns="http://www.w3.org/2000/svg"><path d="M20.016 11.016v1.969H7.828l5.578 5.625L12 20.016 3.984 12 12 3.984l1.406 1.406-5.578 5.625h12.188z"/></symbol><symbol viewBox="0 0 24 24" id="arrow_right_alt" xmlns="http://www.w3.org/2000/svg"><path d="M16.031 11.016v-3L20.015 12l-3.984 3.984v-3H3.984v-1.969h12.047z"/></symbol><symbol viewBox="0 0 24 24" id="bookmark" xmlns="http://www.w3.org/2000/svg"><path d="M15 5.016q.797 0 1.406.586t.609 1.383v16.031l-7.031-3-6.984 3V6.985q0-.797.609-1.383t1.406-.586h9.984zM18.984 18V5.016q0-.797-.586-1.406t-1.383-.609H6.984q0-.797.609-1.406T8.999.986h9.984q.797 0 1.406.609t.609 1.406v15.984z"/></symbol><symbol viewBox="0 0 16 28" id="code" xmlns="http://www.w3.org/2000/svg"><path d="M4.5 23a1.5 1.5 0 10-3.001.001A1.5 1.5 0 004.5 23zm0-18a1.5 1.5 0 10-3.001.001A1.5 1.5 0 004.5 5zm10 2a1.5 1.5 0 10-3.001.001A1.5 1.5 0 0014.5 7zM16 7a3.002 3.002 0 01-1.5 2.594c-.047 5.641-4.047 6.891-6.703 7.734C5.313 18.109 4.5 18.484 4.5 20v.406A3 3 0 016 23a3.001 3.001 0 01-6 0c0-1.109.609-2.078 1.5-2.594V7.594A3 3 0 010 5a3.001 3.001 0 016 0 3.002 3.002 0 01-1.5 2.594v7.766c.797-.391 1.641-.656 2.406-.891 2.906-.922 4.562-1.609 4.594-4.875A3 3 0 0110 7a3.001 3.001 0 016 0z"/></symbol><symbol viewBox="0 0 24 24" id="date" xmlns="http://www.w3.org/2000/svg"><path d="M18.984 20.016V9H5.015v11.016h13.969zm0-16.032q.797 0 1.406.609t.609 1.406v14.016q0 .797-.609 1.383t-1.406.586H5.015q-.844 0-1.43-.563t-.586-1.406V5.999q0-.797.586-1.406t1.43-.609h.984V2.015h2.016v1.969h7.969V2.015H18v1.969h.984zm-1.968 7.032v1.969H15v-1.969h2.016zm-4.032 0v1.969h-1.969v-1.969h1.969zm-3.984 0v1.969H6.984v-1.969H9z"/></symbol><symbol viewBox="0 0 24 24" id="download" xmlns="http://www.w3.org/2000/svg"><path d="M5.016 18h13.969v2.016H5.016V18zm13.968-9L12 15.984 5.016 9H9V3h6v6h3.984z"/></symbol><symbol viewBox="0 0 24 24" id="email" xmlns="http://www.w3.org/2000/svg"><path d="M20.016 8.016V6L12 11.016 3.984 6v2.016L12 12.985zm0-4.032q.797 0 1.383.609t.586 1.406v12q0 .797-.586 1.406t-1.383.609H3.985q-.797 0-1.383-.609t-.586-1.406v-12q0-.797.586-1.406t1.383-.609h16.031z"/></symbol><symbol viewBox="0 0 24 28" id="github" xmlns="http://www.w3.org/2000/svg"><path d="M12 2c6.625 0 12 5.375 12 12 0 5.297-3.437 9.797-8.203 11.391-.609.109-.828-.266-.828-.578 0-.391.016-1.687.016-3.297 0-1.125-.375-1.844-.812-2.219 2.672-.297 5.484-1.313 5.484-5.922 0-1.313-.469-2.375-1.234-3.219.125-.313.531-1.531-.125-3.187-1-.313-3.297 1.234-3.297 1.234a11.28 11.28 0 00-6 0S6.704 6.656 5.704 6.969c-.656 1.656-.25 2.875-.125 3.187-.766.844-1.234 1.906-1.234 3.219 0 4.594 2.797 5.625 5.469 5.922-.344.313-.656.844-.766 1.609-.688.313-2.438.844-3.484-1-.656-1.141-1.844-1.234-1.844-1.234-1.172-.016-.078.734-.078.734.781.359 1.328 1.75 1.328 1.75.703 2.141 4.047 1.422 4.047 1.422 0 1 .016 1.937.016 2.234 0 .313-.219.688-.828.578C3.439 23.796.002 19.296.002 13.999c0-6.625 5.375-12 12-12zM4.547 19.234c.031-.063-.016-.141-.109-.187-.094-.031-.172-.016-.203.031-.031.063.016.141.109.187.078.047.172.031.203-.031zm.484.532c.063-.047.047-.156-.031-.25-.078-.078-.187-.109-.25-.047-.063.047-.047.156.031.25.078.078.187.109.25.047zm.469.703c.078-.063.078-.187 0-.297-.063-.109-.187-.156-.266-.094-.078.047-.078.172 0 .281s.203.156.266.109zm.656.656c.063-.063.031-.203-.063-.297-.109-.109-.25-.125-.313-.047-.078.063-.047.203.063.297.109.109.25.125.313.047zm.891.391c.031-.094-.063-.203-.203-.25-.125-.031-.266.016-.297.109s.063.203.203.234c.125.047.266 0 .297-.094zm.984.078c0-.109-.125-.187-.266-.172-.141 0-.25.078-.25.172 0 .109.109.187.266.172.141 0 .25-.078.25-.172zm.906-.156c-.016-.094-.141-.156-.281-.141-.141.031-.234.125-.219.234.016.094.141.156.281.125s.234-.125.219-.219z"/></symbol><symbol viewBox="0 0 28 28" id="heart" xmlns="http://www.w3.org/2000/svg"><path d="M14 26c-.25 0-.5-.094-.688-.281l-9.75-9.406c-.125-.109-3.563-3.25-3.563-7C-.001 4.735 2.796 2 7.468 2c2.734 0 5.297 2.156 6.531 3.375C15.233 4.156 17.796 2 20.53 2c4.672 0 7.469 2.734 7.469 7.313 0 3.75-3.437 6.891-3.578 7.031l-9.734 9.375a.972.972 0 01-.688.281z"/></symbol><symbol viewBox="0 0 24 24" id="link" xmlns="http://www.w3.org/2000/svg"><path d="M17.016 6.984q2.063 0 3.516 1.477T21.985 12t-1.453 3.539-3.516 1.477h-4.031v-1.922h4.031q1.266 0 2.18-.914T20.11 12t-.914-2.18-2.18-.914h-4.031V6.984h4.031zm-9 6v-1.969h7.969v1.969H8.016zM3.891 12q0 1.266.914 2.18t2.18.914h4.031v1.922H6.985q-2.063 0-3.516-1.477T2.016 12t1.453-3.539 3.516-1.477h4.031v1.922H6.985q-1.266 0-2.18.914T3.891 12z"/></symbol><symbol viewBox="0 0 24 24" id="menu" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2.016H3V6zm0 6.984v-1.969h18v1.969H3zM3 18v-2.016h18V18H3z"/></symbol><symbol viewBox="0 0 24 24" id="notification" xmlns="http://www.w3.org/2000/svg"><path d="M18 15.984L20.016 18v.984H3.985V18l2.016-2.016v-4.969q0-2.344 1.195-4.078t3.305-2.25v-.703q0-.609.422-1.055t1.078-.445 1.078.445.422 1.055v.703q2.109.516 3.305 2.25t1.195 4.078v4.969zm-6 6q-.844 0-1.43-.563t-.586-1.406h4.031q0 .797-.609 1.383T12 21.984z"/></symbol><symbol viewBox="0 0 24 24" id="path" xmlns="http://www.w3.org/2000/svg"><path d="M21.984 11.016H15v-3h-2.016v7.969H15v-3h6.984v8.016H15v-3h-3.984V8.017H9v3H2.016V3.001H9v3h6v-3h6.984v8.016z"/></symbol><symbol viewBox="0 0 24 24" id="pencil" xmlns="http://www.w3.org/2000/svg"><path d="M30.173 7.542l-.314.314-5.726-5.729.313-.313S25.817.001 27.767.001c.859 0 1.832.353 2.849 1.37 3.354 3.354-.443 6.171-.443 6.171zm-2.194 2.195L8.48 29.243 0 32l2.756-8.485v-.003h.002L22.254 4.007l.252.253zM2.76 29.239l4.237-1.219-2.894-3.082-1.343 4.301z"/></symbol><symbol viewBox="0 0 24 24" id="person" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.016q2.531 0 5.273 1.102t2.742 2.883v2.016H3.984v-2.016q0-1.781 2.742-2.883t5.273-1.102zM12 12q-1.641 0-2.813-1.172T8.015 8.015t1.172-2.836T12 3.984t2.813 1.195 1.172 2.836-1.172 2.813T12 12z"/></symbol><symbol viewBox="0 0 24 24" id="search" xmlns="http://www.w3.org/2000/svg"><path d="M9.516 14.016q1.875 0 3.188-1.313t1.313-3.188-1.313-3.188-3.188-1.313-3.188 1.313-1.313 3.188 1.313 3.188 3.188 1.313zm6 0l4.969 4.969-1.5 1.5-4.969-4.969v-.797l-.281-.281q-1.781 1.547-4.219 1.547-2.719 0-4.617-1.875T3.001 9.516t1.898-4.617 4.617-1.898 4.594 1.898 1.875 4.617q0 .984-.469 2.227t-1.078 1.992l.281.281h.797z"/></symbol><symbol viewBox="0 0 20 28" id="shield" xmlns="http://www.w3.org/2000/svg"><path d="M17 15V5h-7v17.766c.797-.422 2.078-1.156 3.328-2.141C15 19.312 17 17.266 17 15zm3-12v12c0 6.578-9.203 10.734-9.594 10.906-.125.063-.266.094-.406.094s-.281-.031-.406-.094C9.203 25.734 0 21.578 0 15V3c0-.547.453-1 1-1h18c.547 0 1 .453 1 1z"/></symbol><symbol viewBox="0 0 32 32" id="tags" xmlns="http://www.w3.org/2000/svg"><path d="M5 5c-1.104 0-2 .887-2 2v8l13.381 13.381c.716.716 1.838.78 2.62.191L5 14.5V5.007 5zm11-1l13.381 13.381c.783.783.787 2.051.008 2.831l-7.177 7.177a2.003 2.003 0 01-2.831-.008L6 14V6c0-1.112.895-2 2-2h8zm-4.5 7a1.5 1.5 0 10-.001-3.001A1.5 1.5 0 0011.5 11z"/></symbol><symbol viewBox="0 0 35 32" id="telescope" xmlns="http://www.w3.org/2000/svg"><path d="M27.464 2.314a.501.501 0 00-.698-.257L14.86 8.339a.499.499 0 00-.233.621l.245.641-6.873 3.769a.5.5 0 00-.222.63l.228.549-7.299 3.488a.5.5 0 00-.246.643l1.498 3.61a.5.5 0 00.629.28l7.625-2.701.228.549a.5.5 0 00.601.289l7.276-2.097.218.569a.497.497 0 00.612.299l13-4a.498.498 0 00.317-.663l-5-12.501zM2.7 21.469l-1.134-2.734 6.823-3.261 1.439 3.47L2.7 21.469zm8.491-1.846l-.238-.574-1.843-4.445-.238-.573 6.336-3.475 2.374 6.134.375.981-6.766 1.952zm8.109-1.238l-.203-.531c-.003-.011-.001-.024-.006-.035l-.618-1.597-2.754-7.206 11.023-5.815 4.592 11.48L19.3 18.385zM28.964.314a.5.5 0 00-.929.371l6 15a.502.502 0 00.651.279.501.501 0 00.279-.65l-6.001-15zM18 21h-3c-1.14 0-2 .86-2 2v1.315l-5.879 6.859a.5.5 0 10.758.651L13.73 25H16v6.5a.5.5 0 001 0V25h2.27l5.85 6.825a.497.497 0 00.705.054.5.5 0 00.054-.705L20 24.315v-1.24C20 21.912 19.122 21 18 21zm1 3h-5v-1c0-.589.411-1 1-1h3c.57 0 1 .462 1 1.075V24z"/></symbol></svg>

    <div class="wrapper">
        <input type="checkbox" class="hidden" id="menu-control" />
        <header class="gdoc-header">
    <div class="container flex align-center justify-between">
        
        <label for="menu-control" class="gdoc-nav__control">
            <svg class="icon menu"><use xlink:href="#menu"></use></svg>
            <svg class="icon arrow-back"><use xlink:href="#arrow_back"></use></svg>
        </label>
        
        <a class="gdoc-header__link" href="https://owncloud.github.io/">
            <span class="gdoc-brand flex align-center">
                <img class="gdoc-brand__img" src="/logo.png" alt="owncloud" width=38 height=38>
                owncloud
            </span>
        </a>
    </div>
</header>


        <main class="container flex flex-even">
            <aside class="gdoc-nav">
                <nav>
    
    <div class="gdoc-search">
        <svg class="icon search"><use xlink:href="#search"></use></svg>
        <input type="text" id="gdoc-search-input" class="gdoc-search__input" placeholder="Search..."
            aria-label="Search" maxlength="64" />
        <div class="gdoc-search__spinner spinner hidden"></div>
        <ul id="gdoc-search-results" class="gdoc-search__list"></ul>
    </div>



    <section class="gdoc-nav--main">
        <h2>Navigation</h2>
        
            

    

    <ul class="gdoc-nav__list">
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/ocis/" class="gdoc-nav__entry ">
                        Infinite Scale
                    </a>
                </span>
            

            
            
                
    

    <ul class="gdoc-nav__list">
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/ocis/getting-started/" class="gdoc-nav__entry ">
                        Getting Started
                    </a>
                </span>
            

            
            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/ocis/bridge/" class="gdoc-nav__entry is-active">
                        Bridge
                    </a>
                </span>
            

            
            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/ocis/extensions/" class="gdoc-nav__entry ">
                        Extensions
                    </a>
                </span>
            

            
            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/ocis/building/" class="gdoc-nav__entry ">
                        Building
                    </a>
                </span>
            

            
            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/ocis/license/" class="gdoc-nav__entry ">
                        License
                    </a>
                </span>
            

            
            
            </li>
            
            
        
    </ul>

            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">Extensions</span>
            

            
            
                
    

    <ul class="gdoc-nav__list">
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_hello/" class="gdoc-nav__entry ">
                        Hello
                    </a>
                </span>
            

            
            
                
    

    <ul class="gdoc-nav__list">
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_hello/getting-started/" class="gdoc-nav__entry ">
                        Getting Started
                    </a>
                </span>
            

            
            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_hello/building/" class="gdoc-nav__entry ">
                        Building
                    </a>
                </span>
            

            
            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_hello/license/" class="gdoc-nav__entry ">
                        License
                    </a>
                </span>
            

            
            
            </li>
            
            
        
    </ul>

            
            </li>
            
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_konnectd/" class="gdoc-nav__entry ">
                        Konnectd
                    </a>
                </span>
            

            
            
                
    

    <ul class="gdoc-nav__list">
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_konnectd/getting-started/" class="gdoc-nav__entry ">
                        Getting Started
                    </a>
                </span>
            

            
            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_konnectd/building/" class="gdoc-nav__entry ">
                        Building
                    </a>
                </span>
            

            
            
            </li>
            
            
        
    </ul>

            
            </li>
            
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_proxy/" class="gdoc-nav__entry ">
                        Proxy
                    </a>
                </span>
            

            
            
                
    

    <ul class="gdoc-nav__list">
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_proxy/about/" class="gdoc-nav__entry ">
                        About
                    </a>
                </span>
            

            
            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_proxy/getting-started/" class="gdoc-nav__entry ">
                        Getting Started
                    </a>
                </span>
            

            
            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_proxy/building/" class="gdoc-nav__entry ">
                        Building
                    </a>
                </span>
            

            
            
            </li>
            
            
        
    </ul>

            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_accounts/" class="gdoc-nav__entry ">
                        Accounts
                    </a>
                </span>
            

            
            
                
    

    <ul class="gdoc-nav__list">
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_accounts/getting-started/" class="gdoc-nav__entry ">
                        Getting Started
                    </a>
                </span>
            

            
            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_accounts/building/" class="gdoc-nav__entry ">
                        Building
                    </a>
                </span>
            

            
            
            </li>
            
            
        
    </ul>

            
            </li>
            
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_glauth/" class="gdoc-nav__entry ">
                        GLAuth
                    </a>
                </span>
            

            
            
                
    

    <ul class="gdoc-nav__list">
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_glauth/getting-started/" class="gdoc-nav__entry ">
                        Getting Started
                    </a>
                </span>
            

            
            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_glauth/building/" class="gdoc-nav__entry ">
                        Building
                    </a>
                </span>
            

            
            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_glauth/license/" class="gdoc-nav__entry ">
                        License
                    </a>
                </span>
            

            
            
            </li>
            
            
        
    </ul>

            
            </li>
            
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_reva/" class="gdoc-nav__entry ">
                        Reva
                    </a>
                </span>
            

            
            
                
    

    <ul class="gdoc-nav__list">
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_reva/getting-started/" class="gdoc-nav__entry ">
                        Getting Started
                    </a>
                </span>
            

            
            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_reva/building/" class="gdoc-nav__entry ">
                        Building
                    </a>
                </span>
            

            
            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_reva/users/" class="gdoc-nav__entry ">
                        Users
                    </a>
                </span>
            

            
            
            </li>
            
            
        
            
            
            <li>
            
                <span class="flex">
                    <a href="/extensions/ocis_reva/license/" class="gdoc-nav__entry ">
                        License
                    </a>
                </span>
            

            
            
            </li>
            
            
        
    </ul>

            
            </li>
            
            
        
    </ul>

            
            </li>
            
            
        
    </ul>





        
    </section>

    <section class="gdoc-nav--more">
        
    </section>
</nav>

            </aside>

            <div class="gdoc-page">
                
    


    






<div class="gdoc-page__header flex flex-wrap justify-between" itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
    <span>
        
            <span class="breadcrumb">
                <svg class="icon path"><use xlink:href="#path"></use></svg>
                
                
    
    
        
        
        
    
    
        
        
        
    
    
        <a href='/'>Documentation</a> / <a href='/ocis/'>Infinite Scale</a> / Bridge
    

    

    

            </span>
        
    </span>
    <span>
        
            <svg class="icon code"><use xlink:href="#code"></use></svg>
            <a href="https://github.com/owncloud/ocis/edit/master/docs/bridge.md">
                Edit this page
            </a>
        
    </span>
</div>


    <article class="gdoc-markdown">
        <h1>Bridge</h1>
        




    




<p>We are planning to build a bridge from ownCloud 10 to ocis. The idea is to have a reverse proxy infront of ownCloud 10 that will forward requests to ownCloud 10 or ocis-reva, depending on the migration status of the logged in user.</p>

<p>This document is a work in progress of the current setup.</p>

<h2 id="current-status"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#current-status" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#current-status"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Current status</h2>

<p>Using ocis and the ownCloud 10 openidconnect and graphapi plugins it is possible today to introduce openid connect based authentication to existing instances. That is a prerequisite for migrating to ocis.</p>

<h2 id="how-to-do-it"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#how-to-do-it" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#how-to-do-it"><svg class="icon link"><use xlink:href="#link"></use></svg></a>How to do it</h2>

<h3 id="install-the-owncloud-10-graphapi-app"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#install-the-owncloud-10-graphapi-app" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#install-the-owncloud-10-graphapi-app"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Install the owncloud 10 graphapi app</h3>

<p>In an owncloud 10 apps folder</p>

<pre><code>$ git clone git@github.com:owncloud/graphapi.git
$ cd graphapi
$ composer install
</code></pre>

<p>No configuration necessary. You can test with <code>curl</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-console" data-lang="console">$ curl https://cloud.example.com/index.php/apps/graphapi/v1.0/users -u admin | jq
Enter host password for user &#39;admin&#39;:
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   694  100   694    0     0   4283      0 --:--:-- --:--:-- --:--:--  4283
{
  &#34;value&#34;: [
    {
      &#34;id&#34;: &#34;admin&#34;,
      &#34;displayName&#34;: &#34;admin&#34;,
      &#34;mail&#34;: null
    },
    {
      &#34;id&#34;: &#34;demo&#34;,
      &#34;displayName&#34;: &#34;Demo&#34;,
      &#34;mail&#34;: null
    },
    ...

  ],
  &#34;@odata.nextLink&#34;: &#34;https://oc.butonic.de/apps/graphapi/v1.0/users?$top=10&amp;$skip=10&#34;
}</code></pre></div>
<blockquote>
<p>Note: The MS graph api actually asks for <code>Bearer</code> auth, but in order to check users passwords during an LDAP bind we are exploiting ownClouds authentication implementation that will grant access when <code>Basic</code> auth is used. An LDAP Bind you may ask? Read on!</p>
</blockquote>

<h3 id="start-ocis-glauth"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#start-ocis-glauth" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#start-ocis-glauth"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Start ocis-glauth</h3>

<p>We are going to use the above ownCloud 10 and graphapi app to turn it into the datastore for an LDAP proxy.</p>

<h4 id="grab-it"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#grab-it" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#grab-it"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Grab it!</h4>

<p>In an <code>ocis</code> folder</p>

<pre><code>$ git clone git@github.com:owncloud/ocis-glauth.git
$ cd ocis-glauth
$ git checkout start-glauth
$ make
</code></pre>

<p>This should give you a <code>bin/ocis-glauth</code> binary. Try listing the help with <code>bin/ocis-glauth --help</code>.</p>

<p>TODO merge glauth PR <a href="https://github.com/owncloud/ocis-glauth/pull/1">https://github.com/owncloud/ocis-glauth/pull/1</a></p>

<h4 id="run-it"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#run-it" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#run-it"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Run it!</h4>

<p>You need to point <code>ocis-glauth</code> to your owncloud domain:</p>
<div class="highlight"><pre class="chroma"><code class="language-console" data-lang="console">$ bin/ocis-glauth --log-level debug server --backend-server https://cloud.example.com --backend-basedn dc=example,dc=com</code></pre></div>
<p><code>--log-level debug</code> is only used to generate more verbose output
<code>--backend-server https://cloud.example.com</code> is the url to an ownCloud instance with an enabled graphapi app
<code>--backend-basedn dc=example,dc=com</code> is used to construct the LDAP dn. The user <code>admin</code> will become <code>cn=admin,dc=example,dc=com</code>.</p>

<h4 id="check-it-is-up-and-running"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#check-it-is-up-and-running" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#check-it-is-up-and-running"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Check it is up and running</h4>

<p>You should now be able to list accounts from your ownCloud 10 oc_accounts table using:</p>
<div class="highlight"><pre class="chroma"><code class="language-console" data-lang="console">$ ldapsearch -x -H ldap://localhost:9125 -b dc=example,dc=com -D &#34;cn=admin,dc=example,dc=com&#34; -W &#39;(objectclass=posixaccount)&#39;</code></pre></div>
<p>Groups should work as well:</p>
<div class="highlight"><pre class="chroma"><code class="language-console" data-lang="console">$ ldapsearch -x -H ldap://localhost:9125 -b dc=example,dc=com -D &#34;cn=admin,dc=example,dc=com&#34; -W &#39;(objectclass=posixgroup)&#39;</code></pre></div>
<blockquote>
<p>Note: This is currently a readonly implementation and minimal to the usecase of authenticating users with konnectd.</p>
</blockquote>

<h3 id="start-ocis-phoenix"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#start-ocis-phoenix" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#start-ocis-phoenix"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Start ocis-phoenix</h3>

<h4 id="get-it"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#get-it" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#get-it"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Get it!</h4>

<p>In an <code>ocis</code> folder</p>

<pre><code>$ git clone git@github.com:owncloud/ocis-phoenix.git
$ cd ocis-phoenix
$ make
</code></pre>

<p>This should give you a <code>bin/ocis-phoenix</code> binary. Try listing the help with <code>bin/ocis-phoenix --help</code>.</p>

<h4 id="run-it-1"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#run-it-1" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#run-it-1"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Run it!</h4>

<p>Point <code>ocis-phoenix</code> to your owncloud domain and tell it where to find the openid connect issuing authority:</p>
<div class="highlight"><pre class="chroma"><code class="language-console" data-lang="console">$ bin/ocis-phoenix server --web-config-server https://cloud.example.com --oidc-authority https://192.168.1.100:9130 --oidc-metadata-url https://192.168.1.100:9130/.well-known/openid-configuration --oidc-client-id ocis</code></pre></div>
<p><code>ocis-phoenix</code> needs to know
- <code>--web-config-server https://cloud.example.com</code> is ownCloud url with webdav and ocs endpoints (oc10 or ocis)
- <code>--oidc-authority https://192.168.1.100:9130</code> the openid connect issuing authority, in our case <code>oidc-konnectd</code>, running on port 9130
- <code>--oidc-metadata-url https://192.168.1.100:9130/.well-known/openid-configuration</code> the openid connect configuration endpoint, typically the issuer host with <code>.well-known/openid-configuration</code>, but there are cases when another endpoint is used, eg. ping identity provides multiple endpoints to separate domains
- <code>--oidc-client-id ocis</code> the client id we will register later with <code>ocis-konnectd</code> in the <code>identifier-registration.yaml</code></p>

<h3 id="start-ocis-konnectd"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#start-ocis-konnectd" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#start-ocis-konnectd"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Start ocis-konnectd</h3>

<h4 id="get-it-1"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#get-it-1" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#get-it-1"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Get it!</h4>

<p>In an <code>ocis</code> folder</p>

<pre><code>$ git clone git@github.com:owncloud/ocis-konnectd.git
$ cd ocis-konnectd
$ make
</code></pre>

<p>This should give you a <code>bin/ocis-konnectd</code> binary. Try listing the help with <code>bin/ocis-konnectd --help</code>.</p>

<h4 id="set-environment-variables"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#set-environment-variables" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#set-environment-variables"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Set environment variables</h4>

<p>Konnectd needs environment variables to configure the LDAP server:</p>
<div class="highlight"><pre class="chroma"><code class="language-console" data-lang="console">export LDAP_URI=ldap://192.168.1.100:9125
export LDAP_BINDDN=&#34;cn=admin,dc=example,dc=com&#34;
export LDAP_BINDPW=&#34;its-a-secret&#34;
export LDAP_BASEDN=&#34;dc=example,dc=com&#34;
export LDAP_SCOPE=sub
export LDAP_LOGIN_ATTRIBUTE=uid
export LDAP_EMAIL_ATTRIBUTE=mail
export LDAP_NAME_ATTRIBUTE=givenName
export LDAP_UUID_ATTRIBUTE=uid
export LDAP_UUID_ATTRIBUTE_TYPE=text
export LDAP_FILTER=&#34;(objectClass=posixaccount)&#34;</code></pre></div>
<p>Don&rsquo;t forget to use an existing user and the correct password.</p>

<h3 id="configure-clients"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#configure-clients" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#configure-clients"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Configure clients</h3>

<p>Now we need to configure a client we can later use to configure the ownCloud 10 openidconnect app. In the <code>assets/identifier-registration.yaml</code> have:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml">--<span class="sd">-
</span><span class="sd">
</span><span class="sd"># OpenID Connect client registry.</span><span class="w">
</span><span class="w"></span>clients<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span>id<span class="p">:</span><span class="w"> </span>ocis<span class="w">
</span><span class="w">    </span>name<span class="p">:</span><span class="w"> </span>ownCloud<span class="w"> </span>Infinite<span class="w"> </span>Scale<span class="w">
</span><span class="w">    </span>insecure<span class="p">:</span><span class="w"> </span>yes<span class="w">
</span><span class="w">    </span>application_type<span class="p">:</span><span class="w"> </span>web<span class="w">
</span><span class="w">    </span>redirect_uris<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>https<span class="p">:</span>//cloud.example.com/apps/openidconnect/redirect<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>http<span class="p">:</span>//localhost<span class="p">:</span><span class="m">9100</span>/oidc-callback.html<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>http<span class="p">:</span>//localhost<span class="p">:</span><span class="m">9100</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>http<span class="p">:</span>//localhost<span class="p">:</span><span class="m">9100</span>/</code></pre></div>
<p>You will need the <code>insecure: yes</code> if you are using self signed certificates.</p>

<p>Replace <code>cloud.example.com</code> in the redirect URI with your ownCloud 10 host and port.
Replace <code>localhost:9100</code> in the redirect URIs with your the <code>ocis-phoenix</code> host and port.</p>

<h4 id="run-it-2"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#run-it-2" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#run-it-2"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Run it!</h4>

<p>You can now bring up <code>ocis-connectd</code> with:</p>
<div class="highlight"><pre class="chroma"><code class="language-console" data-lang="console">$ bin/ocis-konnectd server --iss https://192.168.1.100:9130 --identifier-registration-conf assets/identifier-registration.yaml --signing-kid gen1-2020-02-27</code></pre></div>
<p><code>ocis-konnectd</code> needs to know
- <code>--iss https://192.168.1.100:9130</code> the issuer, which must be a reachable https endpoint. For testing an ip works. HTTPS is NOT optional. This url is exposed in the <code>https://192.168.1.100:9130/.well-known/openid-configuration</code> endpoint and clients need to be able to connect to it
- <code>--identifier-registration-conf assets/identifier-registration.yaml</code> the identifier-registration.yaml you created
- <code>--signing-kid gen1-2020-02-27</code> a signature key id, otherwise the jwks key has no name, which might cause problems with clients. a random key is ok, but it should change when the actual signing key changes.</p>

<h4 id="check-it-is-up-and-running-1"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#check-it-is-up-and-running-1" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#check-it-is-up-and-running-1"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Check it is up and running</h4>

<ol>
<li><p>Try getting the configuration:</p>
<div class="highlight"><pre class="chroma"><code class="language-console" data-lang="console">$ curl https://192.168.1.100:9130/.well-known/openid-configuration</code></pre></div></li>

<li><p>Check if the login works at <a href="https://192.168.1.100:9130/signin/v1/identifier">https://192.168.1.100:9130/signin/v1/identifier</a></p></li>
</ol>

<blockquote>
<p>Note: If you later get a <code>Unable to find a key for (algorithm, kid):PS256, )</code> Error make sure you did set a <code>--signing-kid</code> when starting <code>ocis-konnectd</code> by checking it is present in <a href="https://192.168.1.100:9130/konnect/v1/jwks.json">https://192.168.1.100:9130/konnect/v1/jwks.json</a></p>
</blockquote>

<h3 id="patch-owncloud"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#patch-owncloud" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#patch-owncloud"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Patch owncloud</h3>

<p>While the UserSession in ownCloud 10 is currently used to test all available IAuthModule implementations, it immediately logs out the user when an exception occurs. However, existing owncloud 10 instances use the oauth2 app to create Bearer tokens for mobile and desktop clients.</p>

<p>To give the openidconnect app a chance to verify the tokens we need to change the code a bit. See <a href="https://github.com/owncloud/core/pull/37043">https://github.com/owncloud/core/pull/37043</a> for a possible solution.</p>

<blockquote>
<p>Note: The PR is hot &hellip; as in <em>younger than this list of steps</em>. And it messes with authentication. Use with caution.</p>
</blockquote>

<h3 id="install-the-owncloud-10-openidconnect-app"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#install-the-owncloud-10-openidconnect-app" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#install-the-owncloud-10-openidconnect-app"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Install the owncloud 10 openidconnect app</h3>

<p>In an owncloud 10 apps folder</p>

<pre><code>$ git clone git@github.com:owncloud/openidconnect.git
$ cd openidconnect
$ composer install
</code></pre>

<p>After enabling the app configure it in <code>config/oidc.config.php</code></p>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php">$CONFIG = [
  &#39;openid-connect&#39; =&gt; [
    &#39;provider-url&#39; =&gt; &#39;https://192.168.1.100:9130&#39;,
    &#39;client-id&#39; =&gt; &#39;ocis&#39;,
    &#39;loginButtonName&#39; =&gt; &#39;OpenId Connect @ Konnectd&#39;,
  ],
  &#39;debug&#39; =&gt; true, // if using self signed certificates
  // allow the different domains access to the ocs and wabdav endpoints:
  &#39;cors.allowed-domains&#39; =&gt; [
    &#39;https://cloud.example.com&#39;,
    &#39;http://localhost:9100&#39;,
  ],
];</code></pre></div>
<p>In the above configuration replace
- <code>provider-url</code> with the URL to your <code>ocis-konnectd</code> issuer
- <code>https://cloud.example.com</code> with the URL to your ownCloud 10 instance
- <code>http://localhost:9100</code> with the URL to your phoenix instance</p>

<blockquote>
<p>Note: By default the openidconnect app will use the email of the user to match the user from the oidc userinfo endpoint with the ownCloud account. So make sure your users have a unique primary email.</p>
</blockquote>

<h2 id="next-steps"><a data-clipboard-text="https://owncloud.github.io/ocis/bridge/#next-steps" class="gdoc-page__anchor gdoc-page__anchor--left clip" href="#next-steps"><svg class="icon link"><use xlink:href="#link"></use></svg></a>Next steps</h2>

<p>Aside from the above todos these are the next stepo
- tie it all together behind <code>ocis-proxy</code>
- create an <code>ocis bridge</code> command that runs all the ocis services in one step with a properly preconfigured <code>ocis-konnectd</code> <code>identifier-registration.yaml</code> file for <code>phoenix</code> and the owncloud 10 <code>openidconnect</code> app, as well as a randomized <code>--signing-kid</code>.</p>


    </article>

                








    
    

    





<div class="gdoc-page__footer flex flex-wrap justify-between">
    
    
</div>

            </div>
        </main>

        <footer class="gdoc-footer">
    <div class="container flex flex-wrap">
        <span class="gdoc-footer__item">
            Built with <a href="https://gohugo.io/" class="gdoc-footer__link">Hugo</a> and
            <svg class="icon heart"><use xlink:href="#heart"></use></svg>
        </span>
        
        <span class="gdoc-footer__item">
            <a href="https://owncloud.org/imprint/" class="gdoc-footer__link">Legal Notice</a>
        </span>
        
        
        <span class="gdoc-footer__item">
            <a href="https://owncloud.org/privacy-policy/" class="gdoc-footer__link">Privacy Policy</a>
        </span>
        
    </div>
</footer>

    </div>
</body>






<script defer src="/js/en.search.min.js"></script>



<script src="/js/clipboard.min.js"></script>
<script>
    var clipboard = new ClipboardJS('.clip');
</script>


</html>
